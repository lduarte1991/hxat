<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
{# Load the tag library #}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}
<style>
.sidebar {
    text-align: center;
    border: 1px solid black;
    padding-right: 20px;
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
    width:250px;
}

.sidebar-top {
    text-align: center;
    border: 1px solid black;
    padding: 10px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    border-bottom: 0px;
    width:250px;
}

.sidebar-top #user-label {
    font-family: "arial", sans-serif;
    font-size: 18px;
    font-weight: bold;
}

.sidebar a {
    color:#66ccff;
    font-family: "arial", sans-serif;
    text-decoration:none;
    font-size: 13px;
}

.bar {
    width: 100%;
    border-bottom: 1px solid black;
}

.dashed-bar {
    border-bottom: 1px dashed black;
    margin-top: 10px;
    margin-bottom: 10px;
}

.sidebar p {
    text-align: left;
}

.sidebar .label {
    color: #bbbbbb;
    text-transform: uppercase;
    font-family: "arial", sans-serif;
    font-size: 10px;
}

.header {
    width: 100%;
    height: 100px;
    border-bottom: 4px solid #66ccff;
    margin-bottom: 20px;
}

.section-header{
    color: #999999;
    text-transform: uppercase;
    font-family: "arial", sans-serif;
    font-size: 16px;
    font-weight: bold;
    border-bottom:1px solid #999999;
    margin-bottom: 10px;
}

.course-name {
    color: black;
    text-transform: uppercase;
    font-family: "arial", sans-serif;
    font-size: 22px;
    margin-bottom: 10px;
}

td {
    padding-top: 5px;
    padding-bottom: 5px;
    padding-left: 5px;
    padding-right: 5px;
    font-family: "arial", sans-serif;
}

th {
    /*width: 100%;*/
    padding-top: 5px;
    padding-bottom: 5px;
    font-family: "arial", sans-serif;
}

.settingslink {
    font-size: 12px;
    float: left;
    margin-top: -15px;
}

.leftfloat{
    margin-top: 4px;
    margin-left: -30px;
}

ul {
    text-align: left;
    font-size: 11px;
}

li {
    margin-top: 5px;
    margin-bottom: 5px;
}

#assignments > tbody > tr:nth-child(odd) > td {
    cursor: pointer;
}

#assignments > tbody > tr:nth-child(odd) > td:hover {
    background-color: #66ccff;
}

#assignments > tbody > tr:last-child > td:hover {
    background-color: inherit;
}

.expandicon {
    float: right;
    height: 20px;
    width: 20px;
    background-repeat: no-repeat;
    background-size: contain;
}

.copypaste{
    padding: 20px;
    text-align: center;
    border: 1px solid;
    border-radius: 10px;
    background-color: rgba(0,5,54,0.1);
    margin-top: 20px;
    margin-bottom: 20px;
}

.copypaste p{
    text-align: center;
}

.copypaste pre {
    text-align: center;
}

</style>
<script>
    jQuery(document).ready(function(){
        jQuery('#assignments .clickable').click(function(event){
            $(event.currentTarget).find('span').toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
        });
    });
    var printHelp = function(course_id, collection_id, object_id){
        var el = '#copypaste-' + course_id;
        jQuery(el).html("\
            <p>\
                In order to access the chosen object via LTI, make sure to add the following as custom parameters:\
            </p>\
            <input style='width:100%' type=\"text\" value=\"collection_id="+collection_id+"\">\
            </input><br/>\
            <input style='width:100%' type=\"text\" value=\"object_id="+object_id+"\">\
            </input>\
        ");
        jQuery(el).addClass('copypaste');
        jQuery(el).find('input').first().select();
    
    }
</script>
<div class="header">
</div>
<div class="container">
<!--<pre>-->
<!--{{debug}}-->
<!--</pre>-->
    <div class="row">
        <div class="col-md-3">
            <div class="sidebar-top">
                <div id="user-label">{{ user.username }}</div>
            </div>
            {% if is_instructor %}
            <div class="sidebar">
                <p>
                    <ul>
                        <li>To add a new course, simply initialize LTI tool as an administrator/instructor.</li>
                        <li>Change course settings to edit the name and any people to be considered "admins"</li>
                    </ul>
                </p>
                <!--<div class="dashed-bar"></div>
                <div class="dashed-bar"></div>
                <p>
                    <a class="link" href="./tutorial">View Tutorial</a>
                </p>-->
             </div>
             <br>
             <a role="button" href="instructor_dashboard_view"><div class="btn btn-default">Instructor Dashboard</div></a>
            {% endif %}
        </div>
        <div class="col-md-1"></div>
        <div class="col-md-8">
            <div class="section-header">
                Courses
            </div>
            {% for course in courses %}
            <div class="course-name">
                {{ course.course_name }}
            </div>
            {% if 'Administrator' in roles or 'Instructor' in roles and is_instructor %}
            <a class="settingslink" href="{% url 'hx_lti_initializer:edit_course' id=course.pk %}">Change Course Settings</a>
            {% endif %}
            <div id="copypaste-{{course.id}}"></div>
            <table class="table table-striped" id="assignments">
                <tbody>
                    {% for assignment in course.assignment_set.all %}
                    <tr>
                        <td style="position: absolute; left: -20; cursor: auto; border: none; background-color: transparent">
                            {% if 'Administrator' in roles or 'Instructor' in roles and is_instructor %}
                            <a class="" href="{%url 'hx_lti_assignment:edit_assignment' id=assignment.pk %}">Edit</a>
                            {% endif %}
                        </td>
                    <tr>
                    
                    <tr data-toggle="collapse" data-target="#target-objects-{{ assignment.id }}" class="clickable">
                        <td>
                            <!--{% if 'Administrator' in roles or 'Instructor' in roles and is_instructor %}-->
                            <!--<a class="settingslink leftfloat" href="{%url 'hx_lti_assignment:edit_assignment' id=assignment.pk %}">Edit</a>-->
                            <!--{% endif %}-->
                            {{ assignment.assignment_name }}
                            <span class="expandicon glyphicon glyphicon-chevron-down"></span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <table style="width: 100%; max-width: 100%" class="table table-hover collapse" id="target-objects-{{ assignment.id }}">
                                <thead>
                                    <tr>
                                        <th class="col-md-1">
                                            Title
                                        </th>
                                        <th class="col-md-1">
                                            Author
                                        </th>
                                        <th class="col-md-1">
                                            Date Created
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% load order_by %}
                                    {% for file in assignment.assignment_objects.all|order_by:"assignmenttargets" %}
                                    <tr>
                                        <td>
                                            {% if 'Administrator' in roles or 'Instructor' in roles and is_instructor %}
                                            <a class="settingslink leftfloat" href="{% url 'target_object_database:edit_source' id=file.pk%}">Edit</a>
                                            {% endif %}
                                            <a href="{% url 'hx_lti_initializer:access_annotation_target' course_id=course.course_id assignment_id=assignment.assignment_id object_id=file.id %}">{{ file.target_title }}</a><br />
                                            <!--(<a href="#" onclick="printHelp('{{ course.id }}', '{{ assignment.assignment_id }}', '{{ file.id }}'); return false;">Setup Info</a>)-->
                                        </td>
                                        <td>
                                            {{ file.target_author }}
                                        </td>
                                        <td title="{{ file.target_created }}">
                                            {{ file.target_created | timesince }} ago
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% if is_instructor %}
                                    <!-- TODO: do we want this in? it's a bit buggy, and is somewhat redundant with the 'edit assignment' button <tr>
                                        <td style="text-align:center;" colspan="3">
                                                <a href="{% url 'target_object_database:create_new_source' %}" class="btn btn-success" role="button">

                                                  {% bootstrap_icon "star" %} Add New Source Material
                                                </a>
                                        </td>
                                    </tr>-->
                                    {% endif %}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if is_instructor %}
                    <tr>
                        <td style="text-align:center;">
                            <a href="{% url 'hx_lti_assignment:create_new_assignment' %}" class="btn btn-primary" role="button">
                            {% bootstrap_icon "star" %} Create New Assignment
                            </a>
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
            {% endfor %}
        </div>
    </div>
</div>